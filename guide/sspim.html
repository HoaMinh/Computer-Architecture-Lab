<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hướng dẫn sử dụng JsSpim - Mô phỏng MIPS</title>
    <link rel="stylesheet" href="../css/styles.css">
    <style>
        /* Thêm style riêng cho trang sspim */
        .content-section {
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid #eaeaea;
        }
        
        .function-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }
        
        .function-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1.5rem;
            border-left: 4px solid #3498db;
            transition: transform 0.3s ease;
        }
        
        .function-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .function-card h3 {
            color: #2c3e50;
            margin-top: 0;
            font-size: 1.2rem;
        }
        
        .step-guide {
            background: #e8f4fc;
            border-radius: 8px;
            padding: 2rem;
            margin: 2rem 0;
        }
        
        .step {
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: white;
            border-radius: 6px;
            border-left: 3px solid #3498db;
        }
        
        .step-number {
            display: inline-block;
            background: #3498db;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            text-align: center;
            line-height: 30px;
            margin-right: 10px;
            font-weight: bold;
        }
        
        .code-example {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 1rem;
            border-radius: 6px;
            margin: 1rem 0;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
        }
        
        .register-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }
        
        .register-table th, .register-table td {
            border: 1px solid #ddd;
            padding: 0.75rem;
            text-align: left;
        }
        
        .register-table th {
            background: #3498db;
            color: white;
        }
        
        .register-table tr:nth-child(even) {
            background: #f9f9f9;
        }
        
        .simulator-interface {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            margin: 2rem 0;
        }
        
        .interface-item {
            background: #f5f7fa;
            padding: 1.5rem;
            border-radius: 8px;
            border: 1px solid #e1e5eb;
        }
        
        @media (max-width: 768px) {
            .function-list {
                grid-template-columns: 1fr;
            }
            
            .register-table {
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <header class="main-header">
        <div class="container">
            <h1>Hướng dẫn sử dụng JsSpim</h1>
            <p class="subtitle">Mô phỏng hợp ngữ MIPS trong trình duyệt web</p>
        </div>
    </header>

    <nav class="main-nav">
        <div class="container">
            <ul>
                <li><a href="#gioi-thieu">Giới thiệu</a></li>
                <li><a href="#giao-dien">Giao diện</a></li>
                <li><a href="#huong-dan">Hướng dẫn sử dụng</a></li>
                <li><a href="#vi-du">Ví dụ thực hành</a></li>
                <li><a href="#loi">Gỡ lỗi</a></li>
            </ul>
        </div>
    </nav>

    <main class="container">
        <section id="gioi-thieu" class="content-section">
            <h2>GIỚI THIỆU VỀ JsSpim</h2>
            
            <div class="intro-card">
                <p><strong>JsSpim</strong> là một phiên bản mô phỏng (emulator) của kiến trúc bộ lệnh <strong>MIPS (Microprocessor without Interlocked Pipeline Stages)</strong>, được viết bằng JavaScript và chạy trực tiếp trên trình duyệt web. Nó là công cụ mô phỏng chính cho các bài thực hành lập trình Assembly MIPS.</p>
            </div>
            
            <div class="function-list">
                <div class="function-card">
                    <h3>Học tập Lập trình MIPS Assembly</h3>
                    <p>Cung cấp môi trường để sinh viên viết, dịch, và chạy mã Assembly MIPS. MIPS Assembly là một ngôn ngữ Assembly RISC kinh điển, đơn giản, rất phù hợp để học các nguyên tắc cơ bản của kiến trúc máy tính.</p>
                </div>
                
                <div class="function-card">
                    <h3>Trực quan hóa Thực thi</h3>
                    <p>Cho phép sinh viên chạy mã theo từng bước (step-by-step), quan sát sự thay đổi của Thanh ghi (Registers) và Bộ nhớ (Memory).</p>
                </div>
                
                <div class="function-card">
                    <h3>Bài thực hành Syscall</h3>
                    <p>Giúp sinh viên hiểu cách chương trình Assembly giao tiếp với hệ điều hành thông qua các lệnh Syscall để thực hiện các thao tác nhập/xuất cơ bản (I/O) như in chuỗi, in số, nhập số.</p>
                </div>
                
                <div class="function-card">
                    <h3>Quản lý Stack</h3>
                    <p>Mô phỏng chính xác cơ chế quản lý ngăn xếp (Stack Frame) để thực hiện lời gọi hàm, lưu trữ biến cục bộ và địa chỉ trả về ($ra), là kiến thức nền tảng về tổ chức chương trình.</p>
                </div>
            </div>
        </section>

        <section id="giao-dien" class="content-section">
            <h2>GIAO DIỆN JsSpim</h2>
            
            <p>Giao diện mô phỏng <strong>JsSpim</strong> gồm 6 vùng chức năng chính cho phép người dùng biên dịch, quan sát và kiểm soát việc thực thi chương trình MIPS một cách trực quan:</p>
            
            <div class="simulator-interface">
                <div class="interface-item">
                    <h3>1. Regs - Thanh ghi (Registers Window)</h3>
                    <p><strong>Chức năng:</strong> Hiển thị tất cả các thanh ghi của CPU MIPS</p>
                    
                    <table class="register-table">
                        <thead>
                            <tr>
                                <th>Loại thanh ghi</th>
                                <th>Thanh ghi cụ thể</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>General Purpose Registers (GPRs)</td>
                                <td>$zero, $at, $v0-$v1, $a0-$a3, $t0-$t9, $s0-$s7, $k0-$k1, $gp, $sp, $fp, $ra</td>
                            </tr>
                            <tr>
                                <td>Special Registers</td>
                                <td>HI, LO, PC (Program Counter)</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <p><strong>Cách sử dụng:</strong> Khi chạy chương trình (Run / Step), giá trị của các thanh ghi sẽ tự động cập nhật sau mỗi lệnh.</p>
                </div>
                
                <div class="interface-item">
                    <h3>2. Text Segment - Phân đoạn lệnh</h3>
                    <p><strong>Chức năng:</strong> Hiển thị mã máy MIPS (Assembly) đã được nạp từ chương trình nguồn (.text). Mỗi dòng chứa địa chỉ lệnh, mã nhị phân (hex) và lệnh Assembly tương ứng.</p>
                    <p><strong>Cách sử dụng:</strong> Khi ấn Run hoặc Step, JsSpim sẽ tô sáng dòng lệnh đang được thực thi. Có thể click vào dòng để đặt breakpoint.</p>
                </div>
                
                <div class="interface-item">
                    <h3>3. Data Segment - Phân đoạn dữ liệu</h3>
                    <p><strong>Chức năng:</strong> Hiển thị vùng nhớ dữ liệu tương ứng với phần .data trong chương trình: các biến kiểu word, byte, asciiz (chuỗi ký tự) được khai báo.</p>
                    <div class="code-example">
.data<br>
num: .word 10<br>
str: .asciiz "Hello, MIPS!"<br>
arr: .word 1, 2, 3, 4, 5
                    </div>
                </div>
                
                <div class="interface-item">
                    <h3>4. Output - Kết quả xuất ra màn hình</h3>
                    <p><strong>Chức năng:</strong> Hiển thị kết quả của các lệnh syscall in ra màn hình:</p>
                    <ul>
                        <li>syscall 1 -- in số nguyên</li>
                        <li>syscall 4 -- in chuỗi ký tự</li>
                        <li>syscall 11 -- in ký tự đơn</li>
                    </ul>
                </div>
                
                <div class="interface-item">
                    <h3>5. Log - Nhật ký thực thi (Execution Log)</h3>
                    <p><strong>Chức năng:</strong> Hiển thị toàn bộ quá trình thực thi chi tiết của chương trình: thứ tự lệnh, giá trị thanh ghi trước và sau mỗi lệnh, các thao tác bộ nhớ (đọc/ghi), các cảnh báo hoặc lỗi khi thực thi.</p>
                </div>
                
                <div class="interface-item">
                    <h3>6. User Stack - Ngăn xếp người dùng</h3>
                    <p><strong>Chức năng:</strong> Biểu diễn vùng nhớ stack trong mô hình bộ nhớ MIPS và dùng để lưu trữ tạm thời dữ liệu trong quá trình gọi hàm.</p>
                </div>
            </div>
        </section>

        <section id="huong-dan" class="content-section">
            <h2>HƯỚNG DẪN THỰC HIỆN TRONG ỨNG DỤNG</h2>
            
            <div class="step-guide">
                <div class="step">
                    <h3><span class="step-number">1</span> Truy cập trang web</h3>
                    <p>Truy cập thông qua Cổng thông tin tích hợp: <a href="https://hoaminh.github.io/Computer-Architecture-Lab/" target="_blank">https://hoaminh.github.io/Computer-Architecture-Lab/</a></p>
                    <p>Hoặc truy cập trực tiếp tại: <a href="https://spimsimulator.sourceforge.net/jsSpim.html" target="_blank">JsSpim - spimsimulator.org</a></p>
                </div>
                
                <div class="step">
                    <h3><span class="step-number">2</span> Nhập mã hợp ngữ MIPS</h3>
                    <p>Trong khung soạn thảo, gõ mã lệnh hợp ngữ (Assembly) vào theo đúng cú pháp MIPS:</p>
                    <div class="code-example">
# Ví dụ chương trình cộng hai số<br>
addi $t0, $zero, 5   # Gán $t0 = 5<br>
addi $t1, $zero, 10  # Gán $t1 = 10<br>
add $t2, $t0, $t1    # $t2 = $t0 + $t1
                    </div>
                </div>
                
                <div class="step">
                    <h3><span class="step-number">3</span> Thực thi chương trình mô phỏng</h3>
                    <ul>
                        <li>Nhấn nút <strong>"Run"</strong> ▶️ để chạy toàn bộ chương trình một lần</li>
                        <li>Nhấn <strong>"Step"</strong> để thực hiện từng lệnh giúp quan sát quá trình thay đổi chi tiết</li>
                        <li>Dòng lệnh đang được thực thi sẽ <strong>tô sáng màu vàng</strong> trong vùng Text Segment</li>
                    </ul>
                </div>
                
                <div class="step">
                    <h3><span class="step-number">4</span> Quan sát kết quả mô phỏng</h3>
                    <p>Trong khi chương trình đang chạy, JsSpim sẽ cập nhật trực quan các vùng dữ liệu:</p>
                    <table class="register-table">
                        <thead>
                            <tr>
                                <th>Vùng hiển thị</th>
                                <th>Nội dung cập nhật</th>
                                <th>Mục đích quan sát</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Regs</strong></td>
                                <td>Giá trị của các thanh ghi CPU</td>
                                <td>Theo dõi biến và phép toán</td>
                            </tr>
                            <tr>
                                <td><strong>Text Segment</strong></td>
                                <td>Dòng lệnh hiện tại</td>
                                <td>Xem thứ tự thực thi</td>
                            </tr>
                            <tr>
                                <td><strong>Data Segment</strong></td>
                                <td>Giá trị biến/mảng .data</td>
                                <td>Theo dõi dữ liệu bộ nhớ</td>
                            </tr>
                            <tr>
                                <td><strong>Output</strong></td>
                                <td>Kết quả lệnh syscall</td>
                                <td>Hiển thị chuỗi/số in ra</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="step">
                    <h3><span class="step-number">5</span> Điều chỉnh tốc độ mô phỏng</h3>
                    <p>Dùng <strong>thanh trượt tốc độ (Speed Slider)</strong> ở thanh công cụ để điều chỉnh:</p>
                    <ul>
                        <li>Kéo sang phải → chương trình chạy nhanh hơn</li>
                        <li>Kéo sang trái → chạy chậm hơn, giúp quan sát chi tiết từng lệnh</li>
                    </ul>
                </div>
            </div>
            
            <h3>Tải và chọn tệp MIPS Assembly</h3>
            
            <div class="function-list">
                <div class="function-card">
                    <h3>"Please choose a MIPS assembly file:"</h3>
                    <p>Đây là hộp chọn (dropdown menu) cho phép người dùng chọn chương trình mẫu (.s) có sẵn trong trình mô phỏng.</p>
                    <p><em>Ví dụ:</em> Chọn test_core.s → phần soạn thảo hiển thị mã chương trình cơ bản của CPU MIPS để kiểm tra các thanh ghi $t0-$t7.</p>
                </div>
                
                <div class="function-card">
                    <h3>"upload your own"</h3>
                    <p>Tùy chọn này cho phép người dùng tải lên tệp mã hợp ngữ của riêng mình từ máy tính.</p>
                    <p><em>Ứng dụng thực tế:</em> Sinh viên có thể soạn bài thực hành bằng Notepad++ hoặc VS Code, lưu thành tập tin .s (ví dụ: baitap1.s), sau đó dùng upload your own để nạp vào JsSpim.</p>
                </div>
                
                <div class="function-card">
                    <h3>"Browse"</h3>
                    <p>Nút "Browse" mở hộp thoại chọn tệp từ máy tính. Sau khi chọn xong, tệp sẽ được nạp vào vùng soạn thảo và sẵn sàng chạy mô phỏng.</p>
                    <p><strong>Lưu ý:</strong> Nếu tệp có lỗi cú pháp, JsSpim sẽ hiển thị thông báo trong vùng Log. Sau khi tải lên, nên nhấn Reset trước khi Run để mô phỏng chạy từ đầu.</p>
                </div>
            </div>
        </section>

        <section id="vi-du" class="content-section">
            <h2>VÍ DỤ THỰC HÀNH</h2>
            
            <div class="step-guide">
                <div class="step">
                    <h3>Ví dụ 1: Chương trình in số nguyên</h3>
                    <div class="code-example">
# In số nguyên 25 ra màn hình<br>
.text<br>
main:<br>
    li $v0, 1        # syscall code 1: print integer<br>
    li $a0, 25       # số cần in<br>
    syscall          # thực hiện syscall<br>
    <br>
    li $v0, 10       # syscall code 10: exit<br>
    syscall
                    </div>
                    <p><strong>Kết quả:</strong> Vùng Output sẽ hiển thị: 25</p>
                </div>
                
                <div class="step">
                    <h3>Ví dụ 2: Chương trình in chuỗi</h3>
                    <div class="code-example">
# In chuỗi "Hello, MIPS!" ra màn hình<br>
.data<br>
msg: .asciiz "Hello, MIPS!\n"<br>
<br>
.text<br>
main:<br>
    li $v0, 4        # syscall code 4: print string<br>
    la $a0, msg      # địa chỉ chuỗi cần in<br>
    syscall          # thực hiện syscall<br>
    <br>
    li $v0, 10       # syscall code 10: exit<br>
    syscall
                    </div>
                    <p><strong>Kết quả:</strong> Vùng Output sẽ hiển thị: Hello, MIPS!</p>
                </div>
                
                <div class="step">
                    <h3>Ví dụ 3: Chương trình cộng hai số</h3>
                    <div class="code-example">
# Cộng hai số và in kết quả<br>
.text<br>
main:<br>
    addi $t0, $zero, 15    # $t0 = 15<br>
    addi $t1, $zero, 27    # $t1 = 27<br>
    add $t2, $t0, $t1      # $t2 = $t0 + $t1 = 42<br>
    <br>
    # In kết quả<br>
    li $v0, 1              # syscall code 1: print integer<br>
    move $a0, $t2          # chuyển kết quả vào $a0<br>
    syscall<br>
    <br>
    li $v0, 10             # syscall code 10: exit<br>
    syscall
                    </div>
                    <p><strong>Kết quả:</strong> Vùng Output sẽ hiển thị: 42</p>
                </div>
            </div>
            
            <h3>Bài thực hành nâng cao</h3>
            <ul>
                <li>Chạy thử các lệnh <strong>syscall</strong> khác nhau (print_int, print_string, read_int, read_string)</li>
                <li>Thực hiện <strong>gọi hàm con</strong> (jal, jr) để quan sát thay đổi trong <strong>User Stack</strong></li>
                <li>Dùng "Step" để phân tích chi tiết các chương trình tính tổng, tìm max/min, hoặc factorial</li>
                <li>Thực hành quản lý ngăn xếp khi gọi hàm đệ quy</li>
            </ul>
        </section>

        <section id="loi" class="content-section">
            <h2>GỠ LỖI THƯỜNG GẶP</h2>
            
            <div class="function-list">
                <div class="function-card">
                    <h3>"Address not aligned on word boundary"</h3>
                    <p><strong>Nguyên nhân:</strong> Lỗi địa chỉ không chia hết cho 4 khi thực hiện lệnh lw hoặc sw.</p>
                    <p><strong>Giải pháp:</strong> Kiểm tra địa chỉ bộ nhớ khi load/store word phải chia hết cho 4.</p>
                </div>
                
                <div class="function-card">
                    <h3>"Invalid syscall code"</h3>
                    <p><strong>Nguyên nhân:</strong> Sử dụng mã syscall không hợp lệ.</p>
                    <p><strong>Giải pháp:</strong> Kiểm tra mã syscall đã đặt trong $v0 có hợp lệ không (1, 4, 5, 8, 10, v.v.)</p>
                </div>
                
                <div class="function-card">
                    <h3>Chương trình không in kết quả</h3>
                    <p><strong>Nguyên nhân:</strong> Quên syscall hoặc sai thanh ghi đầu vào.</p>
                    <p><strong>Giải pháp:</strong> Kiểm tra:
                        <ul>
                            <li>Đã đặt mã syscall vào $v0 chưa?</li>
                            <li>Đã đặt tham số vào $a0 (hoặc $a0-$a3) chưa?</li>
                            <li>Đã gọi syscall chưa?</li>
                        </ul>
                    </p>
                </div>
                
                <div class="function-card">
                    <h3>Lỗi cú pháp khi tải file</h3>
                    <p><strong>Nguyên nhân:</strong> File .s có lỗi cú pháp hoặc định dạng không đúng.</p>
                    <p><strong>Giải pháp:</strong> Mở vùng Log để xem chi tiết lỗi và kiểm tra lại cú pháp MIPS.</p>
                </div>
            </div>
            
            <div class="step-guide">
                <h3>Các bước gỡ lỗi cơ bản</h3>
                <div class="step">
                    <h4>Bước 1: Sử dụng chức năng Step</h4>
                    <p>Dùng nút "Step" để chạy từng lệnh, quan sát sự thay đổi của các thanh ghi sau mỗi lệnh.</p>
                </div>
                
                <div class="step">
                    <h4>Bước 2: Kiểm tra vùng Log</h4>
                    <p>Mở vùng Log để xem thông báo lỗi chi tiết và vị trí lỗi xảy ra.</p>
                </div>
                
                <div class="step">
                    <h4>Bước 3: Kiểm tra Data Segment</h4>
                    <p>Xác nhận dữ liệu trong .data đã được khai báo và khởi tạo đúng cách.</p>
                </div>
                
                <div class="step">
                    <h4>Bước 4: Kiểm tra thanh ghi</h4>
                    <p>Quan sát giá trị thanh ghi sau mỗi lệnh để đảm bảo tính toán đúng.</p>
                </div>
            </div>
        </section>
    </main>

    <footer class="main-footer">
        <div class="container">
            <p>Hướng dẫn sử dụng JsSpim - Mô phỏng hợp ngữ MIPS</p>
            <p>Tài liệu thực hành môn Kiến trúc Máy tính</p>
        </div>
    </footer>

    <script src="../js/main.js"></script>
    <script>
        // Script riêng cho trang sspim
        document.addEventListener('DOMContentLoaded', function() {
            // Smooth scroll cho navigation
            document.querySelectorAll('.main-nav a').forEach(anchor => {
                anchor.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetId = this.getAttribute('href');
                    const targetElement = document.querySelector(targetId);
                    
                    if (targetElement) {
                        window.scrollTo({
                            top: targetElement.offsetTop - 80,
                            behavior: 'smooth'
                        });
                    }
                });
            });
            
            // Highlight code blocks
            document.querySelectorAll('.code-example').forEach(block => {
                const pre = document.createElement('pre');
                const code = document.createElement('code');
                code.className = 'language-assembly';
                code.textContent = block.innerHTML;
                pre.appendChild(code);
                block.innerHTML = '';
                block.appendChild(pre);
            });
        });
    </script>
</body>
</html>
